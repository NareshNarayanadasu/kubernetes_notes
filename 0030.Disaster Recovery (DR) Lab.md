Perfect! Here’s a **complete, ready-to-use Kubernetes DR Lab guide for Day 56**, designed to be **fully step-by-step, visual, and hands-on** so you can follow along without missing anything. I’ve included commands, manifests, explanations, and example outputs.

---

# **Day 56: Kubernetes Disaster Recovery (DR) Lab – Step-by-Step**

---

## **1. Lab Objective**

* Learn **Disaster Recovery (DR)** concepts in Kubernetes.
* Simulate **node failure**.
* Use **Velero** to backup and restore workloads.
* Validate restored applications.

---

## **2. Prerequisites**

* Kubernetes cluster (any cluster works: Minikube, EKS, GKE, AKS, self-hosted).
* `kubectl` configured and working.
* Velero CLI installed on your local system.
* Storage bucket configured for Velero backups (S3, GCS, or Azure Blob).

---

## **3. Step 1: Install Velero**

**3.1 Download Velero CLI**

```bash
wget https://github.com/vmware-tanzu/velero/releases/download/v1.12.0/velero-v1.12.0-linux-amd64.tar.gz
tar -xvf velero-v1.12.0-linux-amd64.tar.gz
sudo mv velero-v1.12.0-linux-amd64/velero /usr/local/bin/
```

**3.2 Install Velero in Kubernetes cluster**

**AWS S3 Example**

```bash
velero install \
  --provider aws \
  --bucket <BUCKET_NAME> \
  --secret-file ./credentials-velero \
  --use-volume-snapshots=false \
  --backup-location-config region=<REGION>
```

**Verify Velero deployment**

```bash
kubectl get pods -n velero
```

You should see **Velero pod running**.

---

## **4. Step 2: Deploy Test Workload**

**4.1 Create namespace**

```bash
kubectl create namespace dr-test
```

**4.2 Deploy sample app**

```bash
kubectl create deployment nginx --image=nginx -n dr-test
kubectl expose deployment nginx --port=80 -n dr-test
kubectl get all -n dr-test
```

* You should see `nginx` deployment and pod running.

---

## **5. Step 3: Take Backup Using Velero**

**5.1 Create backup**

```bash
velero backup create dr-test-backup --include-namespaces dr-test
```

**5.2 Verify backup**

```bash
velero backup get
velero backup describe dr-test-backup
```

* Backup status should be `Completed`.

---

## **6. Step 4: Simulate Node Failure**

**6.1 Identify node running pod**

```bash
kubectl get pods -n dr-test -o wide
```

**6.2 Cordon and drain node**

```bash
kubectl cordon <node-name>
kubectl drain <node-name> --ignore-daemonsets --delete-emptydir-data
```

* Pod may go into `Pending` if there’s no available node.

---

## **7. Step 5: Restore Workloads**

**7.1 Restore from backup**

```bash
velero restore create --from-backup dr-test-backup
```

**7.2 Monitor restore**

```bash
velero restore get
kubectl get pods -n dr-test
```

* Check that pods are running again and namespace restored.

---

## **8. Step 6: Validate Application**

```bash
kubectl exec -it <nginx-pod> -n dr-test -- curl localhost
kubectl get svc -n dr-test
```

* Ensure the service is responding.
* All deployments, pods, and resources should match pre-failure state.

---

## **9. Step 7: Optional PV Restore (Persistent Volumes)**

* If workloads use PVs:

```bash
velero backup create dr-test-pv-backup --include-namespaces dr-test --snapshot-volumes
velero restore create --from-backup dr-test-pv-backup
```

* Pods will mount restored PVs automatically.

---

## **10. Step 8: DR Automation & Scheduling**

* Schedule regular backups with Velero:

```bash
velero schedule create daily-dr-backup --schedule="0 2 * * *" --include-namespaces dr-test
```

* Ensures **automatic daily backups** for DR readiness.

---

## **11. Best Practices**

1. Always take **regular backups** and test them.
2. Store backups in **remote/off-cluster storage**.
3. Automate **backup schedules**.
4. Simulate **failures regularly** to validate DR plan.
5. Ensure **Velero has correct RBAC permissions**.
6. Document **restore steps** for the team.

---

## **12. Troubleshooting**

| Issue                         | Solution                                                       |
| ----------------------------- | -------------------------------------------------------------- |
| Velero pod not running        | Check logs: `kubectl logs -n velero <velero-pod>`              |
| Backup fails                  | Check bucket permissions and credentials                       |
| Restore fails                 | Verify namespace exists, resolve resource conflicts            |
| PersistentVolume not restored | Ensure `--snapshot-volumes` flag and compatible storage plugin |

---

## **13. Lab Summary**

* Learned **Kubernetes DR concepts**.
* Practiced **simulating node failure**.
* Used **Velero to backup and restore workloads**.
* Validated restored applications to ensure DR readiness.
* Learned **automation and best practices** for production DR.

✅ **Outcome:**

* Full understanding of DR in Kubernetes.
* Hands-on ability to **backup and restore workloads**.
* Prepared to implement **production-grade DR strategies**.

