Great ðŸ”¥ Now letâ€™s go **deep dive into Day 33â€“34: Taints, Tolerations & Priority**.
This is one of the **most advanced scheduling control mechanisms** in Kubernetes â€” used to **repel or allow pods on specific nodes** and to manage **which pods get scheduled first during resource pressure**.

---

# **Day 33â€“34: Taints, Tolerations & Priority**

---

## **1. Why Taints & Tolerations Matter**

* **Node affinity** = "Pods are *attracted* to nodes."
* **Taints & tolerations** = "Nodes *repel* pods unless pods tolerate them."

ðŸ‘‰ Think of taints as a **keep out sign**.
ðŸ‘‰ Tolerations = **special permission to enter**.

Use cases:

* Dedicated nodes for databases or GPU workloads.
* Isolate system-critical pods from regular apps.
* Protect certain nodes from overloading.

---

## **2. Key Concepts**

### **Taints**

A taint has 3 parts:

```
key=value:effect
```

### **Effects**

1. **NoSchedule** â†’ Pod will *not* schedule on the node.
2. **PreferNoSchedule** â†’ Scheduler will *try* to avoid placing pod, but not guaranteed.
3. **NoExecute** â†’ New pods wonâ€™t schedule, and existing pods will be **evicted**.

---

### **Tolerations**

* Applied to **pods**, not nodes.
* A toleration says: "This pod is allowed to run on tainted nodes."

---

## **3. Priority & Preemption**

* Sometimes cluster runs out of resources â†’ Scheduler decides **which pods to evict**.
* Priority Classes:

  * Higher priority pods can **preempt (evict) lower-priority pods**.
  * Ensures critical apps always run.

---

## **4. Hands-On: Taints & Tolerations**

### Step 1: Apply Taint to Node

```bash
kubectl taint nodes worker1 dedicated=db:NoSchedule
```

ðŸ‘‰ Now **no pod** will schedule on `worker1` unless it has the toleration.

---

### Step 2: Pod without Toleration

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: no-toleration
spec:
  containers:
  - name: nginx
    image: nginx
```

ðŸ‘‰ This pod will remain **Pending**.

---

### Step 3: Pod with Toleration

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: toleration-demo
spec:
  tolerations:
  - key: "dedicated"
    operator: "Equal"
    value: "db"
    effect: "NoSchedule"
  containers:
  - name: nginx
    image: nginx
```

ðŸ‘‰ This pod will schedule on `worker1` because it **tolerates the taint**.

---

### Step 4: Evict Pods with NoExecute

```bash
kubectl taint nodes worker2 critical=true:NoExecute
```

* All existing pods without toleration will be evicted.
* Only pods with `NoExecute` toleration can survive.

---

## **5. Hands-On: Priority & Preemption**

### Step 1: Create Priority Classes

```yaml
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: high-priority
value: 1000
globalDefault: false
description: "For critical apps"

---
apiVersion: scheduling.k8s.io/v1
kind: PriorityClass
metadata:
  name: low-priority
value: 100
globalDefault: false
description: "For non-critical apps"
```

---

### Step 2: Deploy Low-Priority Pods

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: low-priority-pod
spec:
  priorityClassName: low-priority
  containers:
  - name: nginx
    image: nginx
```

---

### Step 3: Deploy High-Priority Pod

```yaml
apiVersion: v1
kind: Pod
metadata:
  name: high-priority-pod
spec:
  priorityClassName: high-priority
  containers:
  - name: nginx
    image: nginx
```

ðŸ‘‰ If resources are tight â†’ `high-priority-pod` will **evict low-priority-pod** and take its place.

---

## **6. Best Practices**

âœ… Use **taints & tolerations** to reserve nodes for special workloads (GPU, DB).
âœ… Use `PreferNoSchedule` for **soft rules** instead of blocking pods.
âœ… Always combine **node affinity + taints** for robust scheduling.
âœ… Assign **priority classes** carefully â†’ donâ€™t make everything `high`.
âœ… Use `globalDefault` priority for workloads without explicit priority.

---

## **7. Troubleshooting**

* **Pod Pending** â†’ check if node has taints and pod lacks tolerations:

  ```bash
  kubectl describe pod <pod>
  ```
* **Pod evicted** â†’ check `Events` for preemption due to priority.
* **Node underutilized** â†’ too restrictive taints.
* **Cluster instability** â†’ too many high-priority pods evicting others.

---

## âœ… Key Takeaways

* **Taints = repel pods**; **Tolerations = allow exceptions**.
* Use **NoSchedule, PreferNoSchedule, NoExecute** effects.
* **Priority classes** ensure critical workloads always run.
* Preemption helps in resource crunch, but must be used carefully.

---


