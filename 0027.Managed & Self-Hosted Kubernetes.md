Perfect! Here’s a **complete ready-to-use lab guide for Day 50–51: Managed & Self-Hosted Kubernetes**, including **step-by-step commands, diagrams, notes, and comparisons**. This is suitable for documentation, training, or practical lab use.

---

# **Day 50–51 Lab Guide – Managed & Self-Hosted Kubernetes**

---

## **1. Lab Objective**

* Learn the difference between **managed and self-hosted Kubernetes clusters**.
* Spin up **managed clusters** on EKS/GKE/AKS.
* Build a **self-hosted test cluster** using kubeadm.
* Deploy workloads, test networking, and understand operational responsibilities.
* Compare overhead, flexibility, security, and cost.

---

## **2. Architecture Diagram**

```
       ┌────────────────────────────┐
       │   Managed Kubernetes       │
       │  (EKS / GKE / AKS)         │
       └────────────────────────────┘
                 │
     Control Plane managed by cloud
                 │
      Worker Nodes (user-managed)
                 │
          ┌─────────────┐
          │ Applications│
          └─────────────┘

       ┌────────────────────────────┐
       │  Self-Hosted Kubernetes    │
       │   (kubeadm / KOPS / RKE)  │
       └────────────────────────────┘
                 │
       Control Plane + Nodes (operator)
                 │
          ┌─────────────┐
          │ Applications│
          └─────────────┘
```

---

## **3. Managed Kubernetes Setup**

### **3.1 Amazon EKS**

```bash
# Create cluster using eksctl
eksctl create cluster \
  --name dev-cluster \
  --region us-east-1 \
  --nodes 3 \
  --nodes-min 2 \
  --nodes-max 5
```

* Control plane managed by AWS.
* Worker nodes can scale automatically.
* Integrated with IAM, CloudWatch, ALB.

### **3.2 Google GKE**

```bash
gcloud container clusters create dev-cluster \
  --num-nodes=3 \
  --zone=us-central1-a
```

* Auto-upgrades and auto-scaling.
* Monitoring via Stackdriver.

### **3.3 Azure AKS**

```bash
az aks create \
  --resource-group myResourceGroup \
  --name dev-cluster \
  --node-count 3 \
  --enable-addons monitoring \
  --generate-ssh-keys
```

* Integrated with Azure Active Directory and Azure Monitor.

**Pros of Managed K8s:**

* Quick setup
* Automatic upgrades
* Production-ready with minimal ops

**Cons:**

* Less control over control plane
* Cloud vendor lock-in
* Higher cost

---

## **4. Self-Hosted Kubernetes with kubeadm**

### **4.1 Kubeadm Overview**

* CLI tool to bootstrap Kubernetes cluster
* Sets up:

  * `kube-apiserver`, `kube-controller-manager`, `kube-scheduler`, `etcd`
  * `kubelet` on nodes
* Supports HA clusters

---

### **4.2 Hands-On Lab: kubeadm Cluster**

#### **Step 1: Prepare Nodes**

* Ubuntu 20.04 / 22.04

```bash
sudo apt update
sudo apt install -y docker.io
sudo systemctl enable docker
sudo systemctl start docker
```

* Install Kubernetes components:

```bash
sudo apt-get update && sudo apt-get install -y apt-transport-https curl
curl -s https://packages.cloud.google.com/apt/doc/apt-key.gpg | sudo apt-key add -
cat <<EOF | sudo tee /etc/apt/sources.list.d/kubernetes.list
deb https://apt.kubernetes.io/ kubernetes-xenial main
EOF
sudo apt-get update
sudo apt-get install -y kubelet kubeadm kubectl
sudo apt-mark hold kubelet kubeadm kubectl
```

---

#### **Step 2: Initialize Control Plane**

```bash
sudo kubeadm init --pod-network-cidr=10.244.0.0/16
```

* Save the `kubeadm join` command for worker nodes.

* Configure kubeconfig for user:

```bash
mkdir -p $HOME/.kube
sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
sudo chown $(id -u):$(id -g) $HOME/.kube/config
```

---

#### **Step 3: Install Pod Network**

* Flannel example:

```bash
kubectl apply -f https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml
```

* Other options: Calico, Weave Net

---

#### **Step 4: Join Worker Nodes**

```bash
sudo kubeadm join <master-ip>:6443 --token <token> --discovery-token-ca-cert-hash sha256:<hash>
```

* Verify:

```bash
kubectl get nodes
kubectl get pods -A
```

---

#### **Step 5: Deploy Sample App**

```bash
kubectl create deployment nginx --image=nginx
kubectl expose deployment nginx --port=80 --type=NodePort
kubectl get svc
kubectl exec -it <nginx-pod> -- ping <other-pod-IP>
```

---

## **5. Security & Best Practices**

* Enable **RBAC**: `--authorization-mode=RBAC`
* Use **network policies** for pod isolation
* Encrypt **etcd** at rest
* Regularly upgrade `kubelet/kubeadm/kubectl`
* Monitor cluster health with **Prometheus + Grafana**
* Deploy **multiple control plane nodes** for HA
* Use **readiness/liveness probes** for workloads

---

## **6. Troubleshooting Common Issues**

| Issue                 | Solution                                                 |
| --------------------- | -------------------------------------------------------- |
| Node not ready        | Check `systemctl status kubelet`, container runtime logs |
| Pod stuck in Pending  | Verify pod network CIDR, CNI plugin installed            |
| kubeadm join fails    | Verify token and CA hash                                 |
| Cluster DNS fails     | Check CoreDNS pods and logs                              |
| Network plugin issues | Verify CIDR, Flannel/Calico installed properly           |

---

## **7. Comparison Table: Managed vs Self-Hosted**

| Feature          | Managed (EKS/GKE/AKS) | Self-Hosted (kubeadm)   |
| ---------------- | --------------------- | ----------------------- |
| Control Plane    | Cloud-managed         | User-managed            |
| Nodes            | User-managed          | User-managed            |
| Upgrades         | Automated             | Manual                  |
| Maintenance      | Minimal               | Full responsibility     |
| Learning         | Medium                | High                    |
| Cost             | High                  | Low (with ops effort)   |
| Customization    | Limited               | Full                    |
| Production-ready | Yes                   | Depends on ops maturity |

---

## **8. Lab Summary**

1. Understand **managed vs self-hosted Kubernetes**.
2. Spin up **managed cluster** (EKS/GKE/AKS) for quick testing.
3. Spin up **self-hosted cluster** with **kubeadm**.
4. Install **network plugin** and join worker nodes.
5. Deploy a **sample application** and validate pod-to-pod communication.
6. Compare **operational overhead, flexibility, security, and cost**.
7. Learn **security best practices** and **troubleshooting steps**.

✅ **Outcome:**

* Full understanding of Kubernetes deployment options.
* Hands-on experience with both managed and self-hosted clusters.
* Ready to deploy workloads securely and troubleshoot clusters.

---

