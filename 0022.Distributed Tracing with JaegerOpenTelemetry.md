Perfect ğŸš€ Youâ€™re now on **Day 40: Tracing** â€” the final pillar of **Observability (Logs + Metrics + Traces)**.
This is where we go beyond *â€œwhat happenedâ€* (logs) and *â€œhow muchâ€* (metrics) to answer **â€œwhere in the request path is the problem?â€**

Iâ€™ll cover **concepts â†’ Jaeger & OpenTelemetry â†’ installation â†’ hands-on lab â†’ tracing a sample app â†’ best practices â†’ troubleshooting**.

---

# **Day 40: Distributed Tracing with Jaeger / OpenTelemetry**

---

## **1. Why Tracing?**

In microservices:

* A single user request may span **10+ services**.
* Each service adds **latency**, and failures are hard to pinpoint.

ğŸ‘‰ **Tracing** helps:

* Track **request journey** across pods/nodes.
* Measure **latency at each hop**.
* Find **bottlenecks and failures**.
* Provide **root cause analysis** for slow requests.

---

## **2. Core Concepts**

* **Trace** â†’ the entire journey of a request.
* **Span** â†’ a single operation within a trace (e.g., DB query, API call).
* **Context Propagation** â†’ metadata (trace ID, span ID) passed via HTTP headers (`traceparent`, `b3`).
* **OpenTelemetry (OTel)** â†’ CNCF standard for tracing, metrics, logs.
* **Jaeger** â†’ a popular open-source tracing backend (collector, query UI, storage).

---

## **3. Jaeger Architecture**

* **Agent**: sidecar or DaemonSet that receives spans.
* **Collector**: processes spans, stores them in backend (memory/Elasticsearch).
* **Query Service**: provides API/UI for viewing traces.
* **UI**: visualize traces (like flame graphs).

---

## **4. Installing Jaeger (Quick Start)**

### Option 1: All-in-One (easy for labs)

```bash
kubectl create namespace observability
kubectl apply -n observability -f \
  https://github.com/jaegertracing/jaeger-operator/releases/download/v1.55.0/jaeger-operator.yaml

kubectl apply -f - <<EOF
apiVersion: jaegertracing.io/v1
kind: Jaeger
metadata:
  name: simple-jaeger
  namespace: observability
EOF
```

### Verify

```bash
kubectl get pods -n observability
```

### Port-forward UI

```bash
kubectl port-forward svc/simple-jaeger-query 16686:16686 -n observability
```

ğŸ‘‰ Open [http://localhost:16686](http://localhost:16686).

---

## **5. OpenTelemetry Collector**

Instead of Jaeger Agent, modern setups use **OTel Collector**:

* Collects spans from apps (SDK/sidecar).
* Exports to Jaeger, Tempo, Zipkin, etc.

Install via Helm:

```bash
helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
helm install my-otel open-telemetry/opentelemetry-collector -n observability
```

---

## **6. Hands-On Lab**

### Step 1: Deploy a Sample App

Use **HotROD app** (included in Jaeger demo).

```bash
kubectl apply -f https://raw.githubusercontent.com/jaegertracing/jaeger/master/examples/hotrod/kubernetes/deployment.yaml -n observability
```

### Step 2: Generate Load

```bash
kubectl port-forward svc/hotrod 8080:8080 -n observability
```

ğŸ‘‰ Open [http://localhost:8080](http://localhost:8080) and click around.

### Step 3: View Traces

* Go to Jaeger UI.
* Search for `frontend` service.
* Explore traces â†’ see how requests call backend services (`driver`, `customer`, `route`).

---

## **7. Key Tracing Queries**

* Find **slowest endpoints**:

  * In Jaeger UI, sort by latency.
* Find **errors in traces**:

  * Filter `error=true`.
* See **service dependency graph**:

  * Jaeger UI â†’ "Dependencies".

---

## **8. Best Practices**

âœ… Use **OpenTelemetry SDKs** in apps (supports Java, Go, Python, Node.js).
âœ… Instrument **critical services** (API gateway, DB, external API calls).
âœ… Always propagate **trace IDs in headers** across services.
âœ… Store traces in **Elasticsearch/Tempo** for persistence.
âœ… Integrate with **Grafana** â†’ correlate traces with logs/metrics.
âœ… Keep trace **sampling rate low** in production (1â€“5%) to reduce overhead.

---

## **9. Troubleshooting**

* **No traces in UI** â†’ app not instrumented, or agent/collector misconfigured.
* **Traces missing spans** â†’ context headers not passed between services.
* **High Jaeger memory usage** â†’ use external storage (Elasticsearch).
* **Latency in UI** â†’ reduce span attributes or sampling rate.

---

