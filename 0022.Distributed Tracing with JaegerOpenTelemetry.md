Perfect 🚀 You’re now on **Day 40: Tracing** — the final pillar of **Observability (Logs + Metrics + Traces)**.
This is where we go beyond *“what happened”* (logs) and *“how much”* (metrics) to answer **“where in the request path is the problem?”**

I’ll cover **concepts → Jaeger & OpenTelemetry → installation → hands-on lab → tracing a sample app → best practices → troubleshooting**.

---

# **Day 40: Distributed Tracing with Jaeger / OpenTelemetry**

---

## **1. Why Tracing?**

In microservices:

* A single user request may span **10+ services**.
* Each service adds **latency**, and failures are hard to pinpoint.

👉 **Tracing** helps:

* Track **request journey** across pods/nodes.
* Measure **latency at each hop**.
* Find **bottlenecks and failures**.
* Provide **root cause analysis** for slow requests.

---

## **2. Core Concepts**

* **Trace** → the entire journey of a request.
* **Span** → a single operation within a trace (e.g., DB query, API call).
* **Context Propagation** → metadata (trace ID, span ID) passed via HTTP headers (`traceparent`, `b3`).
* **OpenTelemetry (OTel)** → CNCF standard for tracing, metrics, logs.
* **Jaeger** → a popular open-source tracing backend (collector, query UI, storage).

---

## **3. Jaeger Architecture**

* **Agent**: sidecar or DaemonSet that receives spans.
* **Collector**: processes spans, stores them in backend (memory/Elasticsearch).
* **Query Service**: provides API/UI for viewing traces.
* **UI**: visualize traces (like flame graphs).

---

## **4. Installing Jaeger (Quick Start)**

### Option 1: All-in-One (easy for labs)

```bash
kubectl create namespace observability
kubectl apply -n observability -f \
  https://github.com/jaegertracing/jaeger-operator/releases/download/v1.55.0/jaeger-operator.yaml

kubectl apply -f - <<EOF
apiVersion: jaegertracing.io/v1
kind: Jaeger
metadata:
  name: simple-jaeger
  namespace: observability
EOF
```

### Verify

```bash
kubectl get pods -n observability
```

### Port-forward UI

```bash
kubectl port-forward svc/simple-jaeger-query 16686:16686 -n observability
```

👉 Open [http://localhost:16686](http://localhost:16686).

---

## **5. OpenTelemetry Collector**

Instead of Jaeger Agent, modern setups use **OTel Collector**:

* Collects spans from apps (SDK/sidecar).
* Exports to Jaeger, Tempo, Zipkin, etc.

Install via Helm:

```bash
helm repo add open-telemetry https://open-telemetry.github.io/opentelemetry-helm-charts
helm install my-otel open-telemetry/opentelemetry-collector -n observability
```

---

## **6. Hands-On Lab**

### Step 1: Deploy a Sample App

Use **HotROD app** (included in Jaeger demo).

```bash
kubectl apply -f https://raw.githubusercontent.com/jaegertracing/jaeger/master/examples/hotrod/kubernetes/deployment.yaml -n observability
```

### Step 2: Generate Load

```bash
kubectl port-forward svc/hotrod 8080:8080 -n observability
```

👉 Open [http://localhost:8080](http://localhost:8080) and click around.

### Step 3: View Traces

* Go to Jaeger UI.
* Search for `frontend` service.
* Explore traces → see how requests call backend services (`driver`, `customer`, `route`).

---

## **7. Key Tracing Queries**

* Find **slowest endpoints**:

  * In Jaeger UI, sort by latency.
* Find **errors in traces**:

  * Filter `error=true`.
* See **service dependency graph**:

  * Jaeger UI → "Dependencies".

---

## **8. Best Practices**

✅ Use **OpenTelemetry SDKs** in apps (supports Java, Go, Python, Node.js).
✅ Instrument **critical services** (API gateway, DB, external API calls).
✅ Always propagate **trace IDs in headers** across services.
✅ Store traces in **Elasticsearch/Tempo** for persistence.
✅ Integrate with **Grafana** → correlate traces with logs/metrics.
✅ Keep trace **sampling rate low** in production (1–5%) to reduce overhead.

---

## **9. Troubleshooting**

* **No traces in UI** → app not instrumented, or agent/collector misconfigured.
* **Traces missing spans** → context headers not passed between services.
* **High Jaeger memory usage** → use external storage (Elasticsearch).
* **Latency in UI** → reduce span attributes or sampling rate.

---

